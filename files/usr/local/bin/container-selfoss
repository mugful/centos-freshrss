#!/bin/bash
set -euo pipefail

# create htpasswd file if not present, but wanted
if [ ! -e /etc/httpd/conf/selfoss-htpasswd -a -n "${SELFOSS_HTPASSWD:-}" ]; then
    echo "$SELFOSS_HTPASSWD" > /etc/httpd/conf/selfoss-htpasswd
fi

# set auth mode for the selfoss web
if [ -e /etc/httpd/conf/selfoss-htpasswd ]; then
    export SELFOSS_WEB_AUTH_REQUIRE="valid-user"
else
    export SELFOSS_WEB_AUTH_REQUIRE="all granted"
fi

chown -R apache: /var/www/selfoss/data /var/www/selfoss/public

exec httpd -DFOREGROUND
